#!/usr/bin/env node

// Git tools

const open = require('open')
const argv = require('yargs').argv
const match = require('match-values').default
const config = require('../../git-tool.json')

const action = argv.a || config.default.action  // alias a
const server = argv.s || config.default.server // alias s
const repoName = argv.r || config.repo // alias r

const actionLink = match(action, {
  'new-pr': () => match(server, {
    github: 'compare',
    bitbucket: 'pull-requests/new',
  }),
  prs: () => match(server, {
    github: 'pulls',
    bitbucket: 'pull-requests',
  }),
  settings: () => match(server, {
    github: 'settings',
    bitbucket: 'admin',
  }),
  open: () => '',
  _: () => action
})
const finalAction = actionLink()

const serverConfig = match(server, {
  github: config.github,
  _: config.bitbucket
})
const user = argv.u || serverConfig.user // alias u
const project = `${serverConfig.host}/${user}/${repoName}/${finalAction}`

open(project)
process.exit(0)
